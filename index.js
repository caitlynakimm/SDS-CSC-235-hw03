// Data from https://github.com/sharmadhiraj/free-json-datasets?tab=readme-ov-file  
// DO NOT MODIFY THE DATA, start your code below 
let myData = [
    {
      "language": "English(excl. creole languages)",
      "family": "Indo-European",
      "branch": "Germanic",
      "first_language_millions": "390",
      "second_language_millions": "1,138",
      "total_millions": "1,528"
    },
    {
      "language": "Mandarin Chinese(incl. Standard Chinese but excl. other varieties)",
      "family": "Sino-Tibetan",
      "branch": "Sinitic",
      "first_language_millions": "990",
      "second_language_millions": "194",
      "total_millions": "1,184"
    },
    {
      "language": "Hindi(excl. Urdu)",
      "family": "Indo-European",
      "branch": "Indo-Aryan",
      "first_language_millions": "345",
      "second_language_millions": "264",
      "total_millions": "609"
    },
    {
      "language": "Spanish(excl. creole languages)",
      "family": "Indo-European",
      "branch": "Romance",
      "first_language_millions": "484",
      "second_language_millions": "74",
      "total_millions": "558"
    },
    {
      "language": "Modern Standard Arabic(excl. dialects)",
      "family": "Afro-Asiatic",
      "branch": "Semitic",
      "first_language_millions": "0",
      "second_language_millions": "335",
      "total_millions": "335"
    },
    {
      "language": "French(excl. creole languages)",
      "family": "Indo-European",
      "branch": "Romance",
      "first_language_millions": "74",
      "second_language_millions": "238",
      "total_millions": "312"
    },
    {
      "language": "Bengali",
      "family": "Indo-European",
      "branch": "Indo-Aryan",
      "first_language_millions": "242",
      "second_language_millions": "43",
      "total_millions": "284"
    },
    {
      "language": "Portuguese(excl. creole languages)",
      "family": "Indo-European",
      "branch": "Romance",
      "first_language_millions": "250",
      "second_language_millions": "17",
      "total_millions": "267"
    },
    {
      "language": "Russian",
      "family": "Indo-European",
      "branch": "Balto-Slavic",
      "first_language_millions": "145",
      "second_language_millions": "108",
      "total_millions": "253"
    },
    {
      "language": "Indonesian",
      "family": "Austronesian",
      "branch": "Malayo-Polynesian",
      "first_language_millions": "75",
      "second_language_millions": "177",
      "total_millions": "252"
    },
    {
      "language": "Urdu(excl. Hindi)",
      "family": "Indo-European",
      "branch": "Indo-Aryan",
      "first_language_millions": "78",
      "second_language_millions": "168",
      "total_millions": "246"
    },
    {
      "language": "Standard German",
      "family": "Indo-European",
      "branch": "Germanic",
      "first_language_millions": "76",
      "second_language_millions": "58",
      "total_millions": "134"
    },
    {
      "language": "Japanese",
      "family": "Japonic",
      "branch": "—",
      "first_language_millions": "124",
      "second_language_millions": "2",
      "total_millions": "126"
    },
    {
      "language": "Nigerian Pidgin",
      "family": "English Creole",
      "branch": "Krio",
      "first_language_millions": "5",
      "second_language_millions": "116",
      "total_millions": "121"
    },
    {
      "language": "Egyptian Arabic(excl. other Arabic dialects)",
      "family": "Afro-Asiatic",
      "branch": "Semitic",
      "first_language_millions": "84",
      "second_language_millions": "35",
      "total_millions": "119"
    },
    {
      "language": "Marathi",
      "family": "Indo-European",
      "branch": "Indo-Aryan",
      "first_language_millions": "83",
      "second_language_millions": "16",
      "total_millions": "99"
    },
    {
      "language": "Vietnamese",
      "family": "Austroasiatic",
      "branch": "Vietic",
      "first_language_millions": "86",
      "second_language_millions": "11",
      "total_millions": "97"
    },
    {
      "language": "Telugu",
      "family": "Dravidian",
      "branch": "South-Central",
      "first_language_millions": "83",
      "second_language_millions": "13",
      "total_millions": "96"
    },
    {
      "language": "Hausa",
      "family": "Afro-Asiatic",
      "branch": "Chadic",
      "first_language_millions": "58",
      "second_language_millions": "36",
      "total_millions": "94"
    },
    {
      "language": "Turkish",
      "family": "Turkic",
      "branch": "Oghuz",
      "first_language_millions": "85",
      "second_language_millions": "6",
      "total_millions": "91"
    },
    {
      "language": "Western Punjabi(excl. Eastern Punjabi)",
      "family": "Indo-European",
      "branch": "Indo-Aryan",
      "first_language_millions": "—",
      "second_language_millions": "—",
      "total_millions": "90"
    },
    {
      "language": "Swahili",
      "family": "Niger–Congo",
      "branch": "Bantu",
      "first_language_millions": "4",
      "second_language_millions": "83",
      "total_millions": "87"
    },
    {
      "language": "Tagalog",
      "family": "Austronesian",
      "branch": "Malayo-Polynesian",
      "first_language_millions": "33",
      "second_language_millions": "54",
      "total_millions": "87"
    },
    {
      "language": "Tamil",
      "family": "Dravidian",
      "branch": "South",
      "first_language_millions": "79",
      "second_language_millions": "8",
      "total_millions": "86"
    },
    {
      "language": "Yue Chinese(incl. Cantonese)",
      "family": "Sino-Tibetan",
      "branch": "Sinitic",
      "first_language_millions": "85",
      "second_language_millions": "1",
      "total_millions": "86"
    },
    {
      "language": "Wu Chinese(incl. Shanghainese)",
      "family": "Sino-Tibetan",
      "branch": "Sinitic",
      "first_language_millions": "83",
      "second_language_millions": "<1",
      "total_millions": "83"
    },
    {
      "language": "Iranian Persian(excl. other Persian dialects)",
      "family": "Indo-European",
      "branch": "Iranian",
      "first_language_millions": "65",
      "second_language_millions": "17",
      "total_millions": "83"
    },
    {
      "language": "Korean",
      "family": "Koreanic",
      "branch": "—",
      "first_language_millions": "81",
      "second_language_millions": "<1",
      "total_millions": "82"
    },
    {
      "language": "Thai",
      "family": "Kra–Dai",
      "branch": "Zhuang–Tai",
      "first_language_millions": "27",
      "second_language_millions": "44",
      "total_millions": "71"
    },
    {
      "language": "Javanese",
      "family": "Austronesian",
      "branch": "Malayo-Polynesian",
      "first_language_millions": "—",
      "second_language_millions": "—",
      "total_millions": "69"
    },
    {
      "language": "Italian",
      "family": "Indo-European",
      "branch": "Romance",
      "first_language_millions": "63",
      "second_language_millions": "3",
      "total_millions": "66"
    },
    {
      "language": "Gujarati",
      "family": "Indo-European",
      "branch": "Indo-Aryan",
      "first_language_millions": "58",
      "second_language_millions": "5",
      "total_millions": "62"
    },
    {
      "language": "Levantine Arabic(excl. other Arabic dialects)",
      "family": "Afro-Asiatic",
      "branch": "Semitic",
      "first_language_millions": "58",
      "second_language_millions": "3",
      "total_millions": "60"
    },
    {
      "language": "Amharic",
      "family": "Afro-Asiatic",
      "branch": "Semitic",
      "first_language_millions": "35",
      "second_language_millions": "25",
      "total_millions": "60"
    },
    {
      "language": "Kannada",
      "family": "Dravidian",
      "branch": "South",
      "first_language_millions": "44",
      "second_language_millions": "15",
      "total_millions": "59"
    },
    {
      "language": "Bhojpuri",
      "family": "Indo-European",
      "branch": "Indo-Aryan",
      "first_language_millions": "53",
      "second_language_millions": "<1",
      "total_millions": "53"
    },
    {
      "language": "Sudanese Arabic(excl. other Arabic dialects)",
      "family": "Afro-Asiatic",
      "branch": "Semitic",
      "first_language_millions": "41",
      "second_language_millions": "11",
      "total_millions": "52"
    }
  ]

let widthOne = 1400;
let heightOne = 1600;
let marginOne = 50;

let frameOne = d3.select("#frameOne svg");

let familyCounts = d3.rollup(myData, d => d.length, d => d.family);
let famData = Array.from(familyCounts, ([key, value]) => ({family: key, count: value}));
console.log(famData);

//sort famData from greatest to lowest frequency
famData.sort(function(a, b) {
  return b.count - a.count;
});

let xAxis = d3.scaleBand()
                  .domain(famData.map(d => d.family))
                  .range([marginOne, widthOne - marginOne]);

xAxis.paddingInner(0.15);


let yAxis = d3.scaleLinear()
              .domain([0, d3.max(famData, d => d.count)])
              .range([heightOne - marginOne, marginOne]);

var colorPalette = d3.scaleOrdinal()
            .domain(famData.map(d => d.family))
            .range(d3.schemeCategory10);

d3.select("#containerOne")
  .selectAll("rect")
  .data(famData)
  .join("rect")
  .attr("x", d => xAxis(d.family))
  .attr("width", xAxis.bandwidth())
  .attr("y", d => yAxis(d.count)) /* gives top of the bar, yAxis() outputs pixel position of top of bar */
  .attr("height", d => (heightOne - marginOne) - yAxis(d.count)) /* heightOne is calculated by bottom - top */
  .attr("fill", function(d) {
    return colorPalette(d.family);
  })
  .on("click", function(event, d) {
    let isHighlighted = d3.select(this).classed("highlighted"); /* checks if clicked on bar has highlighted class attribute */
    d3.select(this).classed("highlighted", !isHighlighted); /* if bar has class, unhighlights/removes class, else highlights/adds class to bar */
  })
  .attr("stroke", "black")
  .attr("stroke-width", "2px");

/*moves y-axis to the right to the marginOne */
frameOne.append("g")
        .attr("transform", `translate(${marginOne}, 0)`)
        .call(d3.axisLeft(yAxis))
        .style("font-size", "18px")
        .style("stroke-width", "2px");

/*moves x-axis to the bottom of the bar chart */
frameOne.append("g")
        .attr("transform", `translate(0, ${heightOne-marginOne})`)
        .call(d3.axisBottom(xAxis)) 
        .style("font-size", "15px")
        .style("stroke-width", "2px");

/*x-axis title*/
frameOne.append("text")
    .attr("x", widthOne/2)
    .attr("y", heightOne - (marginOne/10))
    .attr("text-anchor", "middle")
    .text("Language Family")
    .style("font-size", "22px");

/*y-axis title*/
frameOne.append("text")
    .attr("x", -(heightOne/2))
    .attr("y", marginOne/3)
    .attr("text-anchor", "middle")
    .attr("transform", `rotate(-90)`)
    .text("Frequency")
    .style("font-size", "23px");

/*bar chart title*/
frameOne.append("text")
    .attr("x", widthOne/2)
    .attr("y", marginOne/2)
    .attr("text-anchor", "middle") /*makes text horizontally centered around a pt*/
    .text("Comparison of Language Families")
    .style("font-size", "30px");

let widthTwo = 600;
let heightTwo = 600;
let marginTwo = 50;
let radius = Math.min(widthTwo, heightTwo) / 2 - marginTwo;
let totalCount = d3.sum(famData, d => d.count);
console.log(totalCount);

let pie = d3.pie()
            .value(function(d) {
              return d.count;
            });
let famPieData = pie(famData);
console.log(famPieData);

let arcMaker = d3.arc()
    .innerRadius(0)
    .outerRadius(radius);

let frameTwo = d3.select("#frameTwo svg");

frameTwo.append("text")
    .attr("x", widthTwo/2)
    .attr("y", marginTwo/2)
    .attr("text-anchor", "middle") /*makes text horizontally centered around a pt*/
    .text("Frequency Proportions of Language Families")
    .style("font-size", "30px");

d3.select("#containerTwo")
  .attr("transform", `translate(${widthTwo/2}, ${heightTwo/2})`)
  .selectAll("path")
  .data(famPieData)
  .join("path")
  .attr("d", arcMaker)
  .attr("fill", function(d) {
    return colorPalette(d.data.family);
  })
  .attr("stroke", "black")
  .attr("stroke-width", "2px")
  .on("click", function(event, d) {
    let isPathClicked = d3.select(this).classed("pathHighlight");
    d3.select(this).classed("pathHighlight", !isPathClicked);  /*highlights path/pie piece by making it bigger */

    d3.select("#containerTwo")
      .selectAll("text")
      .filter(textFam => textFam === d) /*search for text with same data object as path*/
      .style("opacity", isPathClicked? 0 : 1) /*makes text appear or disappear based on if path was previously clicked on or not*/
});

d3.select("#containerTwo")
  .selectAll("text")
  .data(famPieData)
  .join("text")
  .style("paint-order", "stroke")
  .style("stroke", "white")
  .style("stroke-width", "7px")
  .style("stroke-linejoin", "round")
  .style("font-size", "20px")
  .style("fill", "black")
  .style("opacity", 0)
  .attr("transform", function(d) {
    return "translate(" + arcMaker.centroid(d) + ")" /*places text elements to be at center of the paths*/
  })
  .attr("text-anchor", "middle") /*makes text horizontally centered around a pt*/
  .attr("dominant-baseline", "middle") /*makes text vertically centered around a pt*/
  .text(d => `${d.data.family}: ${d.data.count}/${totalCount}`); /*shows language family and its frequency proportion*/

